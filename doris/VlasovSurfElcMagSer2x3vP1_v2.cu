//#include <VlasovModDecl.h> 
__host__ __device__ double VlasovSurfElcMag2x3vSer_VX_P1_v2(const int nC, const int nSM, const double *wl, const double *wr, const double *dxvl, const double *dxvr, const double amax, const double *EM, const double *fl, const double *fr, double *outl, double *outr) 
{ 
// w: Cell-center coordinates. dxv[NDIM]: Cell spacing. amax: amax in global lax flux. E: EM field. fl/fr: Distribution function in left/right cells 
// outl/outr: output distribution function in left/right cells 
// returns abs(amid) for use in determining amax in cfl and global lax flux 
  double dv10l = 2/dxvl[2]; 
  double dv10r = 2/dxvr[2]; 
  const double *E0 = &EM[0]; 
  const double dv1 = dxvr[2], wv1 = wr[2]; 
  const double dv2 = dxvr[3], wv2 = wr[3]; 
  const double dv3 = dxvr[4], wv3 = wr[4]; 
  const double *B0 = &EM[12]; 
  const double *B1 = &EM[16]; 
  const double *B2 = &EM[20]; 

  double Ghat[32]; 
  double alpha[21]; 

  // nSM is the stride for SM, which is blockDim.x+2
  double favg[32]; 
  favg[0] = 1*fr[0]+fl[0]; 
  favg[1] = 1*fr[1*nSM]+fl[1*nSM]; 
  favg[2] = 1*fr[2*nSM]+fl[2*nSM]; 
  favg[3] = -1*fr[3*nSM]+fl[3*nSM]; 
  favg[4] = 1*fr[4*nSM]+fl[4*nSM]; 
  favg[5] = 1*fr[5*nSM]+fl[5*nSM]; 
  favg[6] = 1*fr[6*nSM]+fl[6*nSM]; 
  favg[7] = -1*fr[7*nSM]+fl[7*nSM]; 
  favg[8] = -1*fr[8*nSM]+fl[8*nSM]; 
  favg[9] = 1*fr[9*nSM]+fl[9*nSM]; 
  favg[10] = 1*fr[10*nSM]+fl[10*nSM]; 
  favg[11] = -1*fr[11*nSM]+fl[11*nSM]; 
  favg[12] = 1*fr[12*nSM]+fl[12*nSM]; 
  favg[13] = 1*fr[13*nSM]+fl[13*nSM]; 
  favg[14] = -1*fr[14*nSM]+fl[14*nSM]; 
  favg[15] = 1*fr[15*nSM]+fl[15*nSM]; 
  favg[16] = -1*fr[16*nSM]+fl[16*nSM]; 
  favg[17] = 1*fr[17*nSM]+fl[17*nSM]; 
  favg[18] = -1*fr[18*nSM]+fl[18*nSM]; 
  favg[19] = -1*fr[19*nSM]+fl[19*nSM]; 
  favg[20] = 1*fr[20*nSM]+fl[20*nSM]; 
  favg[21] = -1*fr[21*nSM]+fl[21*nSM]; 
  favg[22] = -1*fr[22*nSM]+fl[22*nSM]; 
  favg[23] = 1*fr[23*nSM]+fl[23*nSM]; 
  favg[24] = 1*fr[24*nSM]+fl[24*nSM]; 
  favg[25] = -1*fr[25*nSM]+fl[25*nSM]; 
  favg[26] = -1*fr[26*nSM]+fl[26*nSM]; 
  favg[27] = -1*fr[27*nSM]+fl[27*nSM]; 
  favg[28] = 1*fr[28*nSM]+fl[28*nSM]; 
  favg[29] = -1*fr[29*nSM]+fl[29*nSM]; 
  favg[30] = -1*fr[30*nSM]+fl[30*nSM]; 
  favg[31] = -1*fr[31*nSM]+fl[31*nSM]; 

  double fjump[32]; 
  fjump[0] = amax*(1*fr[0]-fl[0]); 
  fjump[1] = amax*(1*fr[1*nSM]-fl[1*nSM]); 
  fjump[2] = amax*(1*fr[2*nSM]-fl[2*nSM]); 
  fjump[3] = amax*(-1*fr[3*nSM]-fl[3*nSM]); 
  fjump[4] = amax*(1*fr[4*nSM]-fl[4*nSM]); 
  fjump[5] = amax*(1*fr[5*nSM]-fl[5*nSM]); 
  fjump[6] = amax*(1*fr[6*nSM]-fl[6*nSM]); 
  fjump[7] = amax*(-1*fr[7*nSM]-fl[7*nSM]); 
  fjump[8] = amax*(-1*fr[8*nSM]-fl[8*nSM]); 
  fjump[9] = amax*(1*fr[9*nSM]-fl[9*nSM]); 
  fjump[10] = amax*(1*fr[10*nSM]-fl[10*nSM]); 
  fjump[11] = amax*(-1*fr[11*nSM]-fl[11*nSM]); 
  fjump[12] = amax*(1*fr[12*nSM]-fl[12*nSM]); 
  fjump[13] = amax*(1*fr[13*nSM]-fl[13*nSM]); 
  fjump[14] = amax*(-1*fr[14*nSM]-fl[14*nSM]); 
  fjump[15] = amax*(1*fr[15*nSM]-fl[15*nSM]); 
  fjump[16] = amax*(-1*fr[16*nSM]-fl[16*nSM]); 
  fjump[17] = amax*(1*fr[17*nSM]-fl[17*nSM]); 
  fjump[18] = amax*(-1*fr[18*nSM]-fl[18*nSM]); 
  fjump[19] = amax*(-1*fr[19*nSM]-fl[19*nSM]); 
  fjump[20] = amax*(1*fr[20*nSM]-fl[20*nSM]); 
  fjump[21] = amax*(-1*fr[21*nSM]-fl[21*nSM]); 
  fjump[22] = amax*(-1*fr[22*nSM]-fl[22*nSM]); 
  fjump[23] = amax*(1*fr[23*nSM]-fl[23*nSM]); 
  fjump[24] = amax*(1*fr[24*nSM]-fl[24*nSM]); 
  fjump[25] = amax*(-1*fr[25*nSM]-fl[25*nSM]); 
  fjump[26] = amax*(-1*fr[26*nSM]-fl[26*nSM]); 
  fjump[27] = amax*(-1*fr[27*nSM]-fl[27*nSM]); 
  fjump[28] = amax*(1*fr[28*nSM]-fl[28*nSM]); 
  fjump[29] = amax*(-1*fr[29*nSM]-fl[29*nSM]); 
  fjump[30] = amax*(-1*fr[30*nSM]-fl[30*nSM]); 
  fjump[31] = amax*(-1*fr[31*nSM]-fl[31*nSM]); 

  alpha[0] = 2.828427124746191*(B2[0]*wv2+E0[0])-2.828427124746191*B1[0]*wv3; 
  alpha[1] = 2.828427124746191*(B2[1]*wv2+E0[1])-2.828427124746191*B1[1]*wv3; 
  alpha[2] = 2.828427124746191*(B2[2]*wv2+E0[2])-2.828427124746191*B1[2]*wv3; 
  alpha[4] = 0.8164965809277261*B2[0]*dv2; 
  alpha[5] = -0.8164965809277261*B1[0]*dv3; 
  alpha[6] = 2.828427124746191*(B2[3]*wv2+E0[3])-2.828427124746191*B1[3]*wv3; 
  alpha[9] = 0.8164965809277261*B2[1]*dv2; 
  alpha[10] = 0.8164965809277261*B2[2]*dv2; 
  alpha[12] = -0.8164965809277261*B1[1]*dv3; 
  alpha[13] = -0.8164965809277261*B1[2]*dv3; 
  alpha[17] = 0.8164965809277261*B2[3]*dv2; 
  alpha[20] = -0.8164965809277261*B1[3]*dv3; 
  const double amid = 0.1767766952966368*alpha[0]; 

  
  Ghat[0] = alpha[20]*(0.1530931089239486*favg[27]+0.0883883476483184*favg[20])+alpha[17]*(0.1530931089239486*favg[26]+0.0883883476483184*favg[17])+alpha[13]*(0.1530931089239486*favg[22]+0.0883883476483184*favg[13])+alpha[12]*(0.1530931089239486*favg[21]+0.0883883476483184*favg[12])+alpha[10]*(0.1530931089239486*favg[19]+0.0883883476483184*favg[10])+alpha[9]*(0.1530931089239486*favg[18]+0.0883883476483184*favg[9])+alpha[6]*(0.1530931089239486*favg[16]+0.0883883476483184*favg[6])+alpha[5]*(0.1530931089239486*favg[14]+0.0883883476483184*favg[5])+alpha[4]*(0.1530931089239486*favg[11]+0.0883883476483184*favg[4])+alpha[2]*(0.1530931089239486*favg[8]+0.0883883476483184*favg[2])+alpha[1]*(0.1530931089239486*favg[7]+0.0883883476483184*favg[1])-0.8660254037844386*fjump[3]+alpha[0]*(0.1530931089239486*favg[3]+0.0883883476483184*favg[0])-0.5*fjump[0]; 
  Ghat[1] = alpha[13]*(0.1530931089239486*favg[27]+0.0883883476483184*favg[20])+alpha[10]*(0.1530931089239486*favg[26]+0.0883883476483184*favg[17])+alpha[20]*(0.1530931089239486*favg[22]+0.0883883476483184*favg[13])+alpha[5]*(0.1530931089239486*favg[21]+0.0883883476483184*favg[12])+alpha[17]*(0.1530931089239486*favg[19]+0.0883883476483184*favg[10])+alpha[4]*(0.1530931089239486*favg[18]+0.0883883476483184*favg[9])+alpha[2]*(0.1530931089239486*favg[16]+0.0883883476483184*favg[6])+alpha[12]*(0.1530931089239486*favg[14]+0.0883883476483184*favg[5])+alpha[9]*(0.1530931089239486*favg[11]+0.0883883476483184*favg[4])+alpha[6]*(0.1530931089239486*favg[8]+0.0883883476483184*favg[2])-0.8660254037844386*fjump[7]+alpha[0]*(0.1530931089239486*favg[7]+0.0883883476483184*favg[1])+alpha[1]*(0.1530931089239486*favg[3]+0.0883883476483184*favg[0])-0.5*fjump[1]; 
  Ghat[2] = alpha[12]*(0.1530931089239486*favg[27]+0.0883883476483184*favg[20])+alpha[9]*(0.1530931089239486*favg[26]+0.0883883476483184*favg[17])+alpha[5]*(0.1530931089239486*favg[22]+0.0883883476483184*favg[13])+alpha[20]*(0.1530931089239486*favg[21]+0.0883883476483184*favg[12])+alpha[4]*(0.1530931089239486*favg[19]+0.0883883476483184*favg[10])+alpha[17]*(0.1530931089239486*favg[18]+0.0883883476483184*favg[9])+alpha[1]*(0.1530931089239486*favg[16]+0.0883883476483184*favg[6])+alpha[13]*(0.1530931089239486*favg[14]+0.0883883476483184*favg[5])+alpha[10]*(0.1530931089239486*favg[11]+0.0883883476483184*favg[4])-0.8660254037844386*fjump[8]+alpha[0]*(0.1530931089239486*favg[8]+0.0883883476483184*favg[2])+alpha[6]*(0.1530931089239486*favg[7]+0.0883883476483184*favg[1])+alpha[2]*(0.1530931089239486*favg[3]+0.0883883476483184*favg[0])-0.5*fjump[2]; 
  Ghat[4] = alpha[20]*(0.1530931089239486*favg[31]+0.0883883476483184*favg[28])+alpha[13]*(0.1530931089239486*favg[30]+0.0883883476483184*favg[24])+alpha[12]*(0.1530931089239486*favg[29]+0.0883883476483184*favg[23])+alpha[6]*(0.1530931089239486*favg[26]+0.0883883476483184*favg[17])+alpha[5]*(0.1530931089239486*favg[25]+0.0883883476483184*favg[15])+alpha[2]*(0.1530931089239486*favg[19]+0.0883883476483184*favg[10])+alpha[1]*(0.1530931089239486*favg[18]+0.0883883476483184*favg[9])+(0.1530931089239486*favg[16]+0.0883883476483184*favg[6])*alpha[17]-0.8660254037844386*fjump[11]+alpha[0]*(0.1530931089239486*favg[11]+0.0883883476483184*favg[4])+(0.1530931089239486*favg[8]+0.0883883476483184*favg[2])*alpha[10]+(0.1530931089239486*favg[7]+0.0883883476483184*favg[1])*alpha[9]-0.5*fjump[4]+(0.1530931089239486*favg[3]+0.0883883476483184*favg[0])*alpha[4]; 
  Ghat[5] = alpha[17]*(0.1530931089239486*favg[31]+0.0883883476483184*favg[28])+alpha[10]*(0.1530931089239486*favg[30]+0.0883883476483184*favg[24])+alpha[9]*(0.1530931089239486*favg[29]+0.0883883476483184*favg[23])+alpha[6]*(0.1530931089239486*favg[27]+0.0883883476483184*favg[20])+alpha[4]*(0.1530931089239486*favg[25]+0.0883883476483184*favg[15])+alpha[2]*(0.1530931089239486*favg[22]+0.0883883476483184*favg[13])+alpha[1]*(0.1530931089239486*favg[21]+0.0883883476483184*favg[12])+(0.1530931089239486*favg[16]+0.0883883476483184*favg[6])*alpha[20]-0.8660254037844386*fjump[14]+alpha[0]*(0.1530931089239486*favg[14]+0.0883883476483184*favg[5])+(0.1530931089239486*favg[8]+0.0883883476483184*favg[2])*alpha[13]+(0.1530931089239486*favg[7]+0.0883883476483184*favg[1])*alpha[12]-0.5*fjump[5]+(0.1530931089239486*favg[3]+0.0883883476483184*favg[0])*alpha[5]; 
  Ghat[6] = alpha[5]*(0.1530931089239486*favg[27]+0.0883883476483184*favg[20])+alpha[4]*(0.1530931089239486*favg[26]+0.0883883476483184*favg[17])+alpha[12]*(0.1530931089239486*favg[22]+0.0883883476483184*favg[13])+alpha[13]*(0.1530931089239486*favg[21]+0.0883883476483184*favg[12])+(0.1530931089239486*favg[14]+0.0883883476483184*favg[5])*alpha[20]+alpha[9]*(0.1530931089239486*favg[19]+0.0883883476483184*favg[10])+alpha[10]*(0.1530931089239486*favg[18]+0.0883883476483184*favg[9])+(0.1530931089239486*favg[11]+0.0883883476483184*favg[4])*alpha[17]-0.8660254037844386*fjump[16]+alpha[0]*(0.1530931089239486*favg[16]+0.0883883476483184*favg[6])+alpha[1]*(0.1530931089239486*favg[8]+0.0883883476483184*favg[2])+alpha[2]*(0.1530931089239486*favg[7]+0.0883883476483184*favg[1])-0.5*fjump[6]+(0.1530931089239486*favg[3]+0.0883883476483184*favg[0])*alpha[6]; 
  Ghat[9] = alpha[13]*(0.1530931089239486*favg[31]+0.0883883476483184*favg[28])+alpha[20]*(0.1530931089239486*favg[30]+0.0883883476483184*favg[24])+alpha[5]*(0.1530931089239486*favg[29]+0.0883883476483184*favg[23])+alpha[2]*(0.1530931089239486*favg[26]+0.0883883476483184*favg[17])+alpha[12]*(0.1530931089239486*favg[25]+0.0883883476483184*favg[15])+alpha[6]*(0.1530931089239486*favg[19]+0.0883883476483184*favg[10])-0.8660254037844386*fjump[18]+alpha[0]*(0.1530931089239486*favg[18]+0.0883883476483184*favg[9])+(0.1530931089239486*favg[8]+0.0883883476483184*favg[2])*alpha[17]+alpha[10]*(0.1530931089239486*favg[16]+0.0883883476483184*favg[6])+alpha[1]*(0.1530931089239486*favg[11]+0.0883883476483184*favg[4])-0.5*fjump[9]+(0.1530931089239486*favg[3]+0.0883883476483184*favg[0])*alpha[9]+alpha[4]*(0.1530931089239486*favg[7]+0.0883883476483184*favg[1]); 
  Ghat[10] = alpha[12]*(0.1530931089239486*favg[31]+0.0883883476483184*favg[28])+alpha[5]*(0.1530931089239486*favg[30]+0.0883883476483184*favg[24])+alpha[20]*(0.1530931089239486*favg[29]+0.0883883476483184*favg[23])+alpha[1]*(0.1530931089239486*favg[26]+0.0883883476483184*favg[17])+alpha[13]*(0.1530931089239486*favg[25]+0.0883883476483184*favg[15])-0.8660254037844386*fjump[19]+alpha[0]*(0.1530931089239486*favg[19]+0.0883883476483184*favg[10])+alpha[6]*(0.1530931089239486*favg[18]+0.0883883476483184*favg[9])+(0.1530931089239486*favg[7]+0.0883883476483184*favg[1])*alpha[17]+alpha[9]*(0.1530931089239486*favg[16]+0.0883883476483184*favg[6])+alpha[2]*(0.1530931089239486*favg[11]+0.0883883476483184*favg[4])-0.5*fjump[10]+(0.1530931089239486*favg[3]+0.0883883476483184*favg[0])*alpha[10]+alpha[4]*(0.1530931089239486*favg[8]+0.0883883476483184*favg[2]); 
  Ghat[12] = alpha[10]*(0.1530931089239486*favg[31]+0.0883883476483184*favg[28])+alpha[17]*(0.1530931089239486*favg[30]+0.0883883476483184*favg[24])+alpha[4]*(0.1530931089239486*favg[29]+0.0883883476483184*favg[23])+alpha[2]*(0.1530931089239486*favg[27]+0.0883883476483184*favg[20])+alpha[9]*(0.1530931089239486*favg[25]+0.0883883476483184*favg[15])+alpha[6]*(0.1530931089239486*favg[22]+0.0883883476483184*favg[13])-0.8660254037844386*fjump[21]+alpha[0]*(0.1530931089239486*favg[21]+0.0883883476483184*favg[12])+(0.1530931089239486*favg[8]+0.0883883476483184*favg[2])*alpha[20]+alpha[13]*(0.1530931089239486*favg[16]+0.0883883476483184*favg[6])+alpha[1]*(0.1530931089239486*favg[14]+0.0883883476483184*favg[5])-0.5*fjump[12]+(0.1530931089239486*favg[3]+0.0883883476483184*favg[0])*alpha[12]+alpha[5]*(0.1530931089239486*favg[7]+0.0883883476483184*favg[1]); 
  Ghat[13] = alpha[9]*(0.1530931089239486*favg[31]+0.0883883476483184*favg[28])+alpha[4]*(0.1530931089239486*favg[30]+0.0883883476483184*favg[24])+alpha[17]*(0.1530931089239486*favg[29]+0.0883883476483184*favg[23])+alpha[1]*(0.1530931089239486*favg[27]+0.0883883476483184*favg[20])+alpha[10]*(0.1530931089239486*favg[25]+0.0883883476483184*favg[15])-0.8660254037844386*fjump[22]+alpha[0]*(0.1530931089239486*favg[22]+0.0883883476483184*favg[13])+alpha[6]*(0.1530931089239486*favg[21]+0.0883883476483184*favg[12])+(0.1530931089239486*favg[7]+0.0883883476483184*favg[1])*alpha[20]+alpha[12]*(0.1530931089239486*favg[16]+0.0883883476483184*favg[6])+alpha[2]*(0.1530931089239486*favg[14]+0.0883883476483184*favg[5])-0.5*fjump[13]+(0.1530931089239486*favg[3]+0.0883883476483184*favg[0])*alpha[13]+alpha[5]*(0.1530931089239486*favg[8]+0.0883883476483184*favg[2]); 
  Ghat[15] = alpha[6]*(0.1530931089239486*favg[31]+0.0883883476483184*favg[28])+alpha[2]*(0.1530931089239486*favg[30]+0.0883883476483184*favg[24])+alpha[1]*(0.1530931089239486*favg[29]+0.0883883476483184*favg[23])+alpha[17]*(0.1530931089239486*favg[27]+0.0883883476483184*favg[20])+alpha[20]*(0.1530931089239486*favg[26]+0.0883883476483184*favg[17])-0.8660254037844386*fjump[25]+alpha[0]*(0.1530931089239486*favg[25]+0.0883883476483184*favg[15])+alpha[10]*(0.1530931089239486*favg[22]+0.0883883476483184*favg[13])+alpha[9]*(0.1530931089239486*favg[21]+0.0883883476483184*favg[12])+alpha[13]*(0.1530931089239486*favg[19]+0.0883883476483184*favg[10])+alpha[12]*(0.1530931089239486*favg[18]+0.0883883476483184*favg[9])-0.5*fjump[15]+alpha[4]*(0.1530931089239486*favg[14]+0.0883883476483184*favg[5])+alpha[5]*(0.1530931089239486*favg[11]+0.0883883476483184*favg[4]); 
  Ghat[17] = alpha[5]*(0.1530931089239486*favg[31]+0.0883883476483184*favg[28])+alpha[12]*(0.1530931089239486*favg[30]+0.0883883476483184*favg[24])+alpha[13]*(0.1530931089239486*favg[29]+0.0883883476483184*favg[23])-0.8660254037844386*fjump[26]+alpha[0]*(0.1530931089239486*favg[26]+0.0883883476483184*favg[17])+alpha[20]*(0.1530931089239486*favg[25]+0.0883883476483184*favg[15])+alpha[1]*(0.1530931089239486*favg[19]+0.0883883476483184*favg[10])+alpha[2]*(0.1530931089239486*favg[18]+0.0883883476483184*favg[9])-0.5*fjump[17]+(0.1530931089239486*favg[3]+0.0883883476483184*favg[0])*alpha[17]+alpha[4]*(0.1530931089239486*favg[16]+0.0883883476483184*favg[6])+alpha[6]*(0.1530931089239486*favg[11]+0.0883883476483184*favg[4])+(0.1530931089239486*favg[7]+0.0883883476483184*favg[1])*alpha[10]+(0.1530931089239486*favg[8]+0.0883883476483184*favg[2])*alpha[9]; 
  Ghat[20] = alpha[4]*(0.1530931089239486*favg[31]+0.0883883476483184*favg[28])+alpha[9]*(0.1530931089239486*favg[30]+0.0883883476483184*favg[24])+alpha[10]*(0.1530931089239486*favg[29]+0.0883883476483184*favg[23])-0.8660254037844386*fjump[27]+alpha[0]*(0.1530931089239486*favg[27]+0.0883883476483184*favg[20])+alpha[17]*(0.1530931089239486*favg[25]+0.0883883476483184*favg[15])+alpha[1]*(0.1530931089239486*favg[22]+0.0883883476483184*favg[13])+alpha[2]*(0.1530931089239486*favg[21]+0.0883883476483184*favg[12])-0.5*fjump[20]+(0.1530931089239486*favg[3]+0.0883883476483184*favg[0])*alpha[20]+alpha[5]*(0.1530931089239486*favg[16]+0.0883883476483184*favg[6])+alpha[6]*(0.1530931089239486*favg[14]+0.0883883476483184*favg[5])+(0.1530931089239486*favg[7]+0.0883883476483184*favg[1])*alpha[13]+(0.1530931089239486*favg[8]+0.0883883476483184*favg[2])*alpha[12]; 
  Ghat[23] = alpha[2]*(0.1530931089239486*favg[31]+0.0883883476483184*favg[28])+alpha[6]*(0.1530931089239486*favg[30]+0.0883883476483184*favg[24])-0.8660254037844386*fjump[29]+alpha[0]*(0.1530931089239486*favg[29]+0.0883883476483184*favg[23])+alpha[10]*(0.1530931089239486*favg[27]+0.0883883476483184*favg[20])+alpha[13]*(0.1530931089239486*favg[26]+0.0883883476483184*favg[17])+alpha[1]*(0.1530931089239486*favg[25]+0.0883883476483184*favg[15])-0.5*fjump[23]+alpha[17]*(0.1530931089239486*favg[22]+0.0883883476483184*favg[13])+alpha[4]*(0.1530931089239486*favg[21]+0.0883883476483184*favg[12])+(0.1530931089239486*favg[19]+0.0883883476483184*favg[10])*alpha[20]+alpha[5]*(0.1530931089239486*favg[18]+0.0883883476483184*favg[9])+alpha[9]*(0.1530931089239486*favg[14]+0.0883883476483184*favg[5])+(0.1530931089239486*favg[11]+0.0883883476483184*favg[4])*alpha[12]; 
  Ghat[24] = alpha[1]*(0.1530931089239486*favg[31]+0.0883883476483184*favg[28])-0.8660254037844386*fjump[30]+alpha[0]*(0.1530931089239486*favg[30]+0.0883883476483184*favg[24])+alpha[6]*(0.1530931089239486*favg[29]+0.0883883476483184*favg[23])+alpha[9]*(0.1530931089239486*favg[27]+0.0883883476483184*favg[20])+alpha[12]*(0.1530931089239486*favg[26]+0.0883883476483184*favg[17])+alpha[2]*(0.1530931089239486*favg[25]+0.0883883476483184*favg[15])-0.5*fjump[24]+alpha[4]*(0.1530931089239486*favg[22]+0.0883883476483184*favg[13])+alpha[17]*(0.1530931089239486*favg[21]+0.0883883476483184*favg[12])+(0.1530931089239486*favg[18]+0.0883883476483184*favg[9])*alpha[20]+alpha[5]*(0.1530931089239486*favg[19]+0.0883883476483184*favg[10])+alpha[10]*(0.1530931089239486*favg[14]+0.0883883476483184*favg[5])+(0.1530931089239486*favg[11]+0.0883883476483184*favg[4])*alpha[13]; 
  Ghat[28] = (-0.8660254037844386*fjump[31])+alpha[0]*(0.1530931089239486*favg[31]+0.0883883476483184*favg[28])+alpha[1]*(0.1530931089239486*favg[30]+0.0883883476483184*favg[24])+alpha[2]*(0.1530931089239486*favg[29]+0.0883883476483184*favg[23])-0.5*fjump[28]+alpha[4]*(0.1530931089239486*favg[27]+0.0883883476483184*favg[20])+alpha[5]*(0.1530931089239486*favg[26]+0.0883883476483184*favg[17])+alpha[6]*(0.1530931089239486*favg[25]+0.0883883476483184*favg[15])+alpha[9]*(0.1530931089239486*favg[22]+0.0883883476483184*favg[13])+alpha[10]*(0.1530931089239486*favg[21]+0.0883883476483184*favg[12])+(0.1530931089239486*favg[11]+0.0883883476483184*favg[4])*alpha[20]+alpha[12]*(0.1530931089239486*favg[19]+0.0883883476483184*favg[10])+alpha[13]*(0.1530931089239486*favg[18]+0.0883883476483184*favg[9])+(0.1530931089239486*favg[14]+0.0883883476483184*favg[5])*alpha[17]; 

  
  if (outr) {
  outr[0] += 0.5*Ghat[0]*dv10r; 
  outr[1*nC] += 0.5*Ghat[1]*dv10r; 
  outr[2*nC] += 0.5*Ghat[2]*dv10r; 
  outr[3*nC] += -0.8660254037844386*Ghat[0]*dv10r; 
  outr[4*nC] += 0.5*Ghat[4]*dv10r; 
  outr[5*nC] += 0.5*Ghat[5]*dv10r; 
  outr[6*nC] += 0.5*Ghat[6]*dv10r; 
  outr[7*nC] += -0.8660254037844386*Ghat[1]*dv10r; 
  outr[8*nC] += -0.8660254037844386*Ghat[2]*dv10r; 
  outr[9*nC] += 0.5*Ghat[9]*dv10r; 
  outr[10*nC] += 0.5*Ghat[10]*dv10r; 
  outr[11*nC] += -0.8660254037844386*Ghat[4]*dv10r; 
  outr[12*nC] += 0.5*Ghat[12]*dv10r; 
  outr[13*nC] += 0.5*Ghat[13]*dv10r; 
  outr[14*nC] += -0.8660254037844386*Ghat[5]*dv10r; 
  outr[15*nC] += 0.5*Ghat[15]*dv10r; 
  outr[16*nC] += -0.8660254037844386*Ghat[6]*dv10r; 
  outr[17*nC] += 0.5*Ghat[17]*dv10r; 
  outr[18*nC] += -0.8660254037844386*Ghat[9]*dv10r; 
  outr[19*nC] += -0.8660254037844386*Ghat[10]*dv10r; 
  outr[20*nC] += 0.5*Ghat[20]*dv10r; 
  outr[21*nC] += -0.8660254037844386*Ghat[12]*dv10r; 
  outr[22*nC] += -0.8660254037844386*Ghat[13]*dv10r; 
  outr[23*nC] += 0.5*Ghat[23]*dv10r; 
  outr[24*nC] += 0.5*Ghat[24]*dv10r; 
  outr[25*nC] += -0.8660254037844386*Ghat[15]*dv10r; 
  outr[26*nC] += -0.8660254037844386*Ghat[17]*dv10r; 
  outr[27*nC] += -0.8660254037844386*Ghat[20]*dv10r; 
  outr[28*nC] += 0.5*Ghat[28]*dv10r; 
  outr[29*nC] += -0.8660254037844386*Ghat[23]*dv10r; 
  outr[30*nC] += -0.8660254037844386*Ghat[24]*dv10r; 
  outr[31*nC] += -0.8660254037844386*Ghat[28]*dv10r; 
  }

  if (outl) {
  outl[0*nC] += -0.5*Ghat[0]*dv10l; 
  outl[1*nC] += -0.5*Ghat[1]*dv10l; 
  outl[2*nC] += -0.5*Ghat[2]*dv10l; 
  outl[3*nC] += -0.8660254037844386*Ghat[0]*dv10l; 
  outl[4*nC] += -0.5*Ghat[4]*dv10l; 
  outl[5*nC] += -0.5*Ghat[5]*dv10l; 
  outl[6*nC] += -0.5*Ghat[6]*dv10l; 
  outl[7*nC] += -0.8660254037844386*Ghat[1]*dv10l; 
  outl[8*nC] += -0.8660254037844386*Ghat[2]*dv10l; 
  outl[9*nC] += -0.5*Ghat[9]*dv10l; 
  outl[10*nC] += -0.5*Ghat[10]*dv10l; 
  outl[11*nC] += -0.8660254037844386*Ghat[4]*dv10l; 
  outl[12*nC] += -0.5*Ghat[12]*dv10l; 
  outl[13*nC] += -0.5*Ghat[13]*dv10l; 
  outl[14*nC] += -0.8660254037844386*Ghat[5]*dv10l; 
  outl[15*nC] += -0.5*Ghat[15]*dv10l; 
  outl[16*nC] += -0.8660254037844386*Ghat[6]*dv10l; 
  outl[17*nC] += -0.5*Ghat[17]*dv10l; 
  outl[18*nC] += -0.8660254037844386*Ghat[9]*dv10l; 
  outl[19*nC] += -0.8660254037844386*Ghat[10]*dv10l; 
  outl[20*nC] += -0.5*Ghat[20]*dv10l; 
  outl[21*nC] += -0.8660254037844386*Ghat[12]*dv10l; 
  outl[22*nC] += -0.8660254037844386*Ghat[13]*dv10l; 
  outl[23*nC] += -0.5*Ghat[23]*dv10l; 
  outl[24*nC] += -0.5*Ghat[24]*dv10l; 
  outl[25*nC] += -0.8660254037844386*Ghat[15]*dv10l; 
  outl[26*nC] += -0.8660254037844386*Ghat[17]*dv10l; 
  outl[27*nC] += -0.8660254037844386*Ghat[20]*dv10l; 
  outl[28*nC] += -0.5*Ghat[28]*dv10l; 
  outl[29*nC] += -0.8660254037844386*Ghat[23]*dv10l; 
  outl[30*nC] += -0.8660254037844386*Ghat[24]*dv10l; 
  outl[31*nC] += -0.8660254037844386*Ghat[28]*dv10l; 
  }
  return std::abs(amid); 
} 

